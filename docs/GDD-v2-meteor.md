# 隕石數學 - 遊戲設計企劃書 v2.2
## Meteor Math

**版本**：2.2
**目標平台**：iPad Safari（Web App）
**目標受眾**：小學三年級學生（8-9 歲）
**學習目標**：熟練九九乘法表

---

## 1. 設計哲學

### 核心理念
> **「每一顆隕石都能擊破」**

**純正向增強設計**，完全排除懲罰機制：

| 設計原則 | 實現方式 |
|---------|---------|
| 無時間壓力 | 隕石落到底部**不會消失**，靜止等待答對 |
| 無失敗狀態 | 答錯可無限重試，沒有 Game Over |
| 速度有獎勵 | 越早擊破，爆破特效越華麗、分數越高 |

### 為何選擇「落下」而非「上飄」

| 面向 | 落下 | 上飄 |
|-----|-----|-----|
| 視線流向 | 上→下（順閱讀慣性）✓ | 下→上（逆閱讀慣性） |
| 視線終點 | 答案區（減少眼球跳動）✓ | 遠離答案區 |
| 認知負荷 | 低（物體引導視線）✓ | 高（需主動轉移注意力） |

---

## 2. 遊戲核心機制 (Core Loop)

### 2.1 多隕石同場機制

遊戲核心採用**重疊生成（Overlapping Generation）**，畫面可同時存在多顆隕石：

```
┌─────────────────────────────────────────────────────────┐
│                      【太空背景】                        │
│                                                         │
│      ┌─────────┐                                        │
│      │  4 × 6  │  ← 隕石 A（左側落下）                  │
│      └─────────┘                                        │
│                              ┌─────────┐                │
│                              │  3 × 7  │  ← 隕石 B     │
│                              └─────────┘    （中間落下）│
│                                                         │
│                    ┌─────────┐                          │
│                    │  8 × 9  │  ← 隕石 C（右側落下）    │
│                    └─────────┘                          │
│                                                         │
│ ═══════════════════【防衛線】═══════════════════════════ │
├─────────────────────────────────────────────────────────┤
│                  【輸入顯示區】                          │
│                    ┌────────┐                           │
│                    │   21   │  ← 輸入 21               │
│                    └────────┘                           │
│                                                         │
│             ▲  ← 砲台瞄準 3×7（答案=21）                │
│            /█\                                          │
├─────────────────────────────────────────────────────────┤
│                 【數字鍵盤 - 2行設計】                    │
│                                                         │
│    ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────────┐ │
│    │  1  │ │  2  │ │  3  │ │  4  │ │  5  │ │   刪    │ │
│    └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ │         │ │
│    ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ │   除    │ │
│    │  6  │ │  7  │ │  8  │ │  9  │ │  0  │ │   ⌫    │ │
│    └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────────┘ │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 2.2 重疊生成規則

| 項目 | 規則 |
|-----|-----|
| 觸發條件 | 前一顆隕石落至 **60-80% 高度** 或 **被擊破** |
| 預生成 | 下一顆隕石在當前隕石生成時已預先生成（但不可見） |
| 最大同場 | 最多 **3 顆隕石** 同時在畫面上 |
| X 軸位置 | 隨機分配於左（20%）、中（50%）、右（80%）三區 |

```
生成時序示意：

時間 →

隕石 1: ████████████████████░░░░░░░░  ← 100% → 被擊破
隕石 2:       ░░░░████████████████████████  ← 60% 開始落下
隕石 3:             ░░░░░░░████████████████████
                         ↑
                    隕石 2 到達 60%
```

### 2.3 自由瞄準機制（無鎖定）

玩家**不需要選擇目標**，輸入正確答案即自動擊中對應隕石：

| 畫面隕石 | 答案 | 玩家輸入 | 結果 |
|---------|-----|---------|-----|
| 4×6 | 24 | `2` `4` | 砲台瞄準 4×6 → 擊破 |
| 3×7 | 21 | `2` `1` | 砲台瞄準 3×7 → 擊破 |
| 8×9 | 72 | `7` `2` | 砲台瞄準 8×9 → 擊破 |
| - | - | `2` `5` | 無對應隕石 → 錯誤提示 |

**視覺流程**：
1. 玩家輸入數字（即時顯示）
2. 系統判斷是否匹配任一隕石答案
3. **若匹配**：砲台轉向該隕石 → 發射光束 → 擊破
4. **若不匹配**：輸入框震動 + 閃紅 → 清空重試

### 2.4 砲台設計

| 項目 | 設計 |
|-----|-----|
| 位置 | 輸入顯示區下方，鍵盤區上方 |
| 造型 | 簡約三角形/太空砲台 |
| 旋轉 | 根據輸入答案瞄準對應隕石（CSS transform） |
| 發射動畫 | 光束從砲台射向目標隕石 |
| 無目標時 | 保持朝上（預設角度） |

### 2.5 防衛線設計

**防衛線（Defense Line）** 是隕石的最低停止位置，確保不會遮擋輸入區：

| 項目 | 設計 |
|-----|-----|
| 位置 | 太空區底部，輸入區上方 |
| 視覺 | 半透明光帶（淡藍/淡綠），微微發光 |
| 功能 | 隕石觸及防衛線後**停止落下**，靜待答對 |
| 互動 | 隕石停在線上時輕微浮動（呼吸動畫） |

```
太空區（隕石活動範圍）
         ↓
══════【防衛線】══════  ← 隕石停止處，畫面佔比約 60% 位置
         ↓
輸入區（永遠不被遮擋）
```

### 2.6 輸入機制：數字鍵盤（2 行設計）

| 按鍵 | 功能 |
|-----|-----|
| 0-9 | 輸入數字，即時顯示於輸入區 |
| ⌫ (刪除) | 跨 2 行大按鈕，刪除最後一位數字 |

**輸入規則**：
- 最多輸入 2 位數（九九乘法最大值 81）
- 輸入後可隨時修改（按 ⌫）
- **輸入滿 2 位數後自動提交**（無需確認鍵）
- 單位數答案（如 9）需手動輸入第二位或等待 1 秒自動提交

**鍵盤佈局**：
```
┌─────┬─────┬─────┬─────┬─────┬─────────┐
│  1  │  2  │  3  │  4  │  5  │         │
├─────┼─────┼─────┼─────┼─────┤   ⌫    │
│  6  │  7  │  8  │  9  │  0  │         │
└─────┴─────┴─────┴─────┴─────┴─────────┘
```

### 2.7 高度分區與獎勵

隕石落下分為 **4 個區段**，依擊破位置給予不同分數：

```
┌──────────────────────┐
│      【天空區】       │  ← 擊破：100 分
│      0% - 25%        │     大爆破 + 流星雨 + 震動
│                      │     「完美！」
├──────────────────────┤
│      【高空區】       │  ← 擊破：80 分
│      25% - 50%       │     爆破 + 星星散落
│                      │     「太棒了！」
├──────────────────────┤
│      【低空區】       │  ← 擊破：60 分
│      50% - 75%       │     中型爆破 + 火花
│                      │     「不錯！」
├──────────────────────┤
│      【地面區】       │  ← 擊破：40 分（最低分）
│      75% - 100%      │     小型爆破
│   （隕石停在此處）    │     「成功！」
│   不消失，等待答對    │
└──────────────────────┘
```

### 2.8 速度獎勵對照表

| 擊破區段 | 畫面位置 | 約略時間 | 分數 | 視覺回饋 | 語音提示 |
|:-------:|:-------:|:-------:|:---:|---------|---------|
| 天空區 | 0-25% | < 1.5 秒 | 100 | 大爆破 + 流星雨 + 震動 | 「完美！」 |
| 高空區 | 25-50% | 1.5-3 秒 | 80 | 爆破 + 星星散落 | 「太棒了！」 |
| 低空區 | 50-75% | 3-5 秒 | 60 | 中型爆破 + 火花 | 「不錯！」 |
| 地面區 | 75-100% | > 5 秒 | 40 | 小型爆破 | 「成功！」 |
| 答錯 | - | - | 0 | 輸入框震動 + 閃紅 | 「再試一次」 |

**重點**：
- 隕石落到地面後**靜止不消失**，玩家仍可作答
- 答對即獲得 40 分（最低保底），**永遠不會失敗**

### 2.9 答錯處理

1. 輸入框**短暫震動 + 紅色閃爍**（視覺提示）
2. 輸入內容**自動清空**，可立即重新輸入
3. **不扣分、不計錯誤次數**（對玩家而言）
4. 後台記錄錯題，用於強化出題

---

## 3. 關卡結構

### 3.1 一輪（Round）= 5 顆隕石

| 項目 | 設定 | 說明 |
|-----|-----|-----|
| 隕石數量 | 5 顆 | 認知負荷適中 |
| 單顆落下時間 | 6-8 秒 | 足夠思考，不急迫 |
| 生成觸發 | 前一顆至 60-80% 或被擊破 | 重疊生成，保持節奏 |
| 最大同場 | 3 顆 | 避免畫面過於混亂 |
| 一輪總時間 | 約 30-60 秒 | 因重疊生成而縮短 |
| 滿分 | 500 分 | 5 題 × 100 分 |

### 3.2 流程圖

```
開始一輪
    ↓
生成隕石 1（預生成隕石 2）
    ↓
┌─────────────────────────────────────────────┐
│ 隕石 1 落下                                  │
│     ├── 到達 60% 高度 → 隕石 2 開始落下      │
│     │                    （預生成隕石 3）    │
│     └── 玩家可隨時輸入答案                   │
│                                              │
│ 【畫面可能同時有 1-3 顆隕石】                 │
│                                              │
│ 玩家輸入 XX：                                │
│   ├── 匹配某顆隕石 → 砲台瞄準 → 擊破 → 得分  │
│   └── 不匹配 → 輸入框震動 → 重試             │
│                                              │
│ 隕石被擊破或到達地面：                        │
│   └── 觸發下一顆隕石生成/落下                │
└─────────────────────────────────────────────┘
    ↓ （重複直到 5 顆隕石全部處理完畢）
┌─────────────────┐
│   一輪結算       │
│ • 總分 (xxx/500) │
│ • 完美次數      │
└────────┬────────┘
         ↓
   繼續 / 返回主選單
```

---

## 4. UI/UX 設計

### 4.1 螢幕佈局（橫向 1024×768）

```
┌────────────────────────────────────────────────────────┐
│ ← 返回    【第 3 輪】    【320 分】            🔇 音效 │  ← 頂部列 (6%)
├────────────────────────────────────────────────────────┤
│                                                        │
│       ┌─────────┐          ✦  ✦    ✦                  │
│       │  4 × 6  │     ✦        ✦       ✦              │
│       └─────────┘                                      │
│                              ┌─────────┐               │  ← 太空區 (48%)
│                              │  3 × 7  │               │     【多隕石區域】
│            ✦                 └─────────┘      ✦       │
│                    ┌─────────┐                         │
│                    │  8 × 9  │                         │
│                    └─────────┘                         │
│ ═══════════════════【防衛線】═══════════════════════   │
├────────────────────────────────────────────────────────┤
│                    ┌────────┐                          │
│                    │   21   │  ← 輸入顯示              │  ← 輸入區 (10%)
│                    └────────┘                          │
│                       ▲  ← 砲台（旋轉瞄準 3×7）        │
│                      /█\                               │
├────────────────────────────────────────────────────────┤
│                                                        │
│   ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌────────┐
│   │   1  │ │   2  │ │   3  │ │   4  │ │   5  │ │        │
│   └──────┘ └──────┘ └──────┘ └──────┘ └──────┘ │   ⌫   │  ← 鍵盤區 (28%)
│   ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ │        │
│   │   6  │ │   7  │ │   8  │ │   9  │ │   0  │ │        │
│   └──────┘ └──────┘ └──────┘ └──────┘ └──────┘ └────────┘
│                                                        │
└────────────────────────────────────────────────────────┘
```

**佈局說明**：
- 太空區可同時顯示最多 3 顆隕石（左/中/右位置）
- 砲台位於輸入顯示區下方，會根據輸入答案旋轉瞄準對應隕石
- 鍵盤從 4 行縮減為 2 行，最大化遊戲區域

### 4.2 砲台規格

| 項目 | 設計 |
|-----|-----|
| 造型 | 簡約太空砲台（三角形砲管 + 圓形底座） |
| 大小 | 砲管 40×20 px，底座半徑 25 px |
| 顏色 | 主體 `#3d5a80`，砲管 `#98c1d9` |
| 旋轉範圍 | -60° ~ +60°（左右各 60 度） |
| 旋轉速度 | 0.2 秒完成瞄準 |
| 發射特效 | 光束從砲管射出，0.15 秒到達目標 |
| 預設狀態 | 砲管朝正上方（0°） |

**瞄準邏輯**：
- 玩家輸入時，即時計算是否匹配任一隕石答案
- 若匹配，砲台**立即開始旋轉**瞄準該隕石
- 答案確認後（2位數或超時），發射光束擊破

### 4.3 數字鍵盤規格（2 行設計）

| 元素 | 尺寸 | 間距 | 說明 |
|-----|-----|-----|-----|
| 數字按鈕 (0-9) | 80×70 px | 8 px | 5+5 排列，共 2 行 |
| 刪除按鈕 (⌫) | 80×148 px | - | 跨 2 行，右側固定 |
| 觸控熱區 | +8 px padding | - | 防誤觸 |
| 字體大小 | 32px 粗體 | - | 清晰易讀 |
| 圓角 | 12px | - | 柔和友善 |
| 按下效果 | 縮放 95% + 變亮 | - | 觸覺回饋 |

**優勢**：2 行設計使鍵盤區高度減半，增加太空區可視範圍。

### 4.4 輸入顯示區

| 元素 | 設計 |
|-----|-----|
| 底色 | 半透明白 `rgba(255,255,255,0.15)` |
| 文字 | 48px 粗體，白色 |
| 寬度 | 160px（最多顯示 2 位數） |
| 游標 | 閃爍豎線（提示可輸入） |

### 4.5 視覺設計規範

#### 色彩配置
| 元素 | 色碼 | 說明 |
|-----|------|-----|
| 太空背景 | `#0a0a2e` → `#1a1a4e` | 深藍漸層 |
| 星星 | `#ffffff`, `#fffacd` | 白色、淡黃閃爍 |
| 隕石 | `#ff6b35` → `#ff8c5a` | 橘紅漸層，帶火焰尾巴 |
| 題目文字 | `#ffffff` | 白色粗體 |
| 鍵盤按鈕 | `#2d2d5a` | 深紫藍 |
| 鍵盤按鈕 hover | `#3d3d7a` | 變亮 |
| 正確回饋 | `#4ade80` | 綠色光暈 |
| 錯誤提示 | `#ef4444` | 紅色閃爍（僅輸入框，短暫） |

#### 隕石設計
- **造型**：圓潤的橢圓形（可愛，不恐怖）
- **火焰尾巴**：向上飄動的橘紅色粒子
- **題目位置**：隕石中央，白色粗體字
- **大小**：約 140×120 px

#### 爆破特效層級
| 層級 | 分數 | 特效 |
|-----|-----|-----|
| 完美 | 100 | 大型圓形擴散 + 20+ 星星粒子 + 螢幕震動 |
| 太棒了 | 80 | 中型擴散 + 12 星星粒子 |
| 不錯 | 60 | 小型擴散 + 6 火花粒子 |
| 成功 | 40 | 快速消散 + 3 火花粒子 |

---

## 5. 題庫系統

### 5.1 難度分級

| 難度 | 乘法範圍 | 出題比例 | 特徵 |
|:---:|---------|:-------:|-----|
| **Easy** | ×1, ×2, ×5, ×10 | 1/3 | 規律明顯，建立信心 |
| **Normal** | ×3, ×4, ×6, ×7, ×8, ×9 | 2/3 | 需熟練計算 |

### 5.2 錯題強化機制

```javascript
// 錯題權重計算
baseWeight = 1
wrongWeight = baseWeight × 3  // 錯題出現率 3 倍

// 移出條件
if (correctStreak >= 3) {
    removeFromWrongPool()
}
```

### 5.3 題目生成

- 隨機從 1-9 × 1-9 範圍抽取
- 依 Easy/Normal 比例（1:2）分配
- 錯題庫有題目時，優先抽取（40% 機率）

---

## 6. 回饋系統

### 6.1 即時回饋（高度分區）

| 擊破區段 | 分數 | 視覺 | 音效 | 語音 |
|---------|:---:|-----|-----|-----|
| 天空區 | 100 | 大爆破 + 流星雨 + 震動 | 華麗音效 | 「完美！」 |
| 高空區 | 80 | 爆破 + 星星散落 | 歡快音效 | 「太棒了！」 |
| 低空區 | 60 | 中型爆破 + 火花 | 正向音效 | 「不錯！」 |
| 地面區 | 40 | 小型爆破 | 輕快音效 | 「成功！」 |
| 答錯 | 0 | 輸入框震動 | 輕柔提示音 | 「再試一次」 |

### 6.2 一輪結算

| 顯示項目 | 說明 |
|---------|-----|
| 總分 | xxx / 500 |
| 完美次數 | 天空區擊破次數 |
| 平均反應 | 平均答題時間（秒） |

**無商店、無徽章系統**，專注於即時回饋與分數挑戰。

---

## 7. 音效設計

### 7.1 音效清單

| 事件 | 音效描述 | 時長 |
|-----|---------|-----|
| 隕石出現 | 輕柔「咻～」劃過聲 | 0.3 秒 |
| 按鍵點擊 | 輕快「嗒」聲 | 0.05 秒 |
| 天空區擊破 | 華麗爆破 + 叮叮聲 | 1.0 秒 |
| 高空區擊破 | 中等爆破聲 | 0.6 秒 |
| 低空區擊破 | 小型爆破聲 | 0.4 秒 |
| 地面區擊破 | 輕快「啵」聲 | 0.3 秒 |
| 答錯 | 低沉「咚」聲 | 0.2 秒 |
| 一輪結束 | 勝利提示音 | 1.0 秒 |

### 7.2 語音提示

| 事件 | 語音 |
|-----|-----|
| 天空區 | 「完美！」 |
| 高空區 | 「太棒了！」 |
| 低空區 | 「不錯！」 |
| 地面區 | 「成功！」 |
| 答錯 | 「再試一次」 |

### 7.3 音量控制
- 預設 50%
- 提供一鍵靜音
- 記憶使用者偏好

---

## 8. 技術規格

### 8.1 技術棧

| 層級 | 技術 | 說明 |
|-----|-----|-----|
| 結構 | HTML5 | 語義化標籤 |
| 樣式 | CSS3 | 動畫使用 CSS transition/animation |
| 互動 | Vanilla JavaScript | 無框架依賴 |
| 隕石動畫 | CSS + requestAnimationFrame | 平滑落下 |
| 爆破特效 | Canvas 2D 粒子系統 | 輕量高效 |
| 音效 | Web Audio API | 低延遲 |
| 存儲 | localStorage | 錯題記錄、設定偏好 |

### 8.2 效能目標

| 指標 | 目標值 |
|-----|-------|
| 首次載入 | < 2 秒 |
| 動畫幀率 | 60 FPS |
| 觸控響應 | < 50ms |
| 粒子數量 | < 50 個/爆破 |

### 8.3 localStorage 結構

```javascript
{
  "meteorMath": {
    "settings": {
      "soundEnabled": true,
      "volume": 50
    },
    "wrongQuestions": {
      "7x8": { wrongCount: 2, correctStreak: 0 },
      "6x7": { wrongCount: 1, correctStreak: 2 }
    },
    "stats": {
      "totalRounds": 0,
      "highScore": 0,
      "totalPerfects": 0
    }
  }
}
```

---

## 9. 設計決策記錄

| 決策 | 選擇 | 理由 |
|-----|-----|-----|
| 落下 vs 上飄 | 落下 | 視線引導至答案區，認知負荷低 |
| 落到底失敗？ | 否（給 40 分） | 維持無壓力原則 |
| 輸入方式 | 數字鍵盤 | 訓練心算，非選擇猜題 |
| 鍵盤佈局 | 2 行 + 跨行刪除鍵 | 減少畫面佔比，增加太空區 |
| 防衛線 | 有 | 防止隕石遮擋輸入區 |
| 商店/徽章 | 不做 | 簡化系統，專注核心體驗 |
| 錯誤提示色 | 紅色（僅輸入框） | 明確但短暫，不造成負面感 |
| 一輪題數 | 5 題 | 平衡專注度與成就感 |
| 分數制 | 100/80/60/40 | 高度分區明確，最低保底 40 |
| 多隕石 | 重疊生成，最多 3 顆同場 | 增加節奏感，減少等待時間 |
| 目標選擇 | 自由瞄準（無鎖定） | 任輸任答，降低操作複雜度 |
| X 軸位置 | 左/中/右隨機 | 視覺變化，避免單調 |
| 砲台 | 有，旋轉瞄準 | 強化擊中回饋，增加動態感 |

---

## 10. 未來擴充（可選）

1. **連擊加分**：連續完美擊破，額外加分
2. **指定練習**：選擇特定乘法段（如只練 ×7）
3. **歷史紀錄**：查看每輪成績趨勢

---

**文件結束**
*版本 2.2 | 更新日期：2026-01-12*
